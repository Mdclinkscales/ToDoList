@using Microsoft.AspNetCore.Http;
@using Microsoft.EntityFrameworkCore;
@using Office.Models;
@model List<Todo>;

<div class="row">
    <div class="col-3"></div>
    <div class="col-6">
        <h2>Active Todo List</h2>
        <table class="table-striped table-bordered text-center">
            <thead class="text-center">
                <th>  Activity  </th>
                <th>  Due Date  </th>
                <th>  Difficulty  </th>
                <th>  Task Creator  </th>
                <th>  No. of Supporters  </th>
                <th></th>
            </thead>
            <tbody>
                @foreach (var activity in Model)
                {
                    <tr>
                        <td><a href="/Todo/@activity.TodoId">@activity.Title</a></td>
                        @if(activity.DueDate<DateTime.Now){
                            <td class="bg-danger">@activity.DueDate.ToShortDateString()</td>
                        }
                        else{
                            <td>@activity.DueDate.ToShortDateString()</td>
                        }
                        @if(activity.Difficulty>4){
                            <td class="bg-danger">@activity.Difficulty</td>
                        }
                        @if(activity.Difficulty>2&activity.Difficulty<5){
                            <td class="bg-warning">@activity.Difficulty</td>
                        }
                        else{
                            <td class="bg-success">@activity.Difficulty</td>
                        }
                        
                        <td>@activity.Giver.FirstName @activity.Giver.LastName</td>
                        <td>@activity.Supporters.Count</td>
                        @if(ViewBag.User!=null){
                            <td>
                                <form action="/rsvp" method="POST">
                                    <input type="hidden" name="UserId" value="@ViewBag.User.UserId">
                                    <input type="hidden" name="TodoId" value="@activity.TodoId">
                                    @if(ViewBag.User.UserId==1){
                                        <input type="submit" value="Complete" class="btn btn-danger">
                                    }
                                    else{
                                        if(activity.Supporters.Any(a=>a.UserId==ViewBag.User.UserId))
                                        {
                                            <input type="submit" value="Remove Support" class="btn btn-primary">
                                        }
                                        else{
                                            <input type="submit" value="Support" class="btn btn-primary">
                                        }
                                    }
                                </form>
                            </td>
                        }
                    </tr>
                }
                <a href="/Todoform">Add a Task!</a>
            </tbody>
        </table>
    </div>
    <div class="col-3"></div>
</div>